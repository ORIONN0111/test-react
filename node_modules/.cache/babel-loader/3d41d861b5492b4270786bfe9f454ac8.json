{"ast":null,"code":"import * as e from \"react\";\n\nvar t = function () {\n  var e = {\n    name: \"__LSM__\",\n    middleWares: [],\n    storageType: {},\n    persist: \"\"\n  },\n      t = {};\n\n  try {\n    e.storageType = \"undefined\" != typeof sessionStorage ? window.sessionStorage : {};\n  } catch (e) {}\n\n  return {\n    updateStore: function (n) {\n      try {\n        t = JSON.parse(e.storageType.getItem(e.name) || \"\") || n;\n      } catch (e) {\n        t = n;\n      }\n    },\n    saveStore: function () {\n      e.storageType.setItem(e.name, JSON.stringify(t));\n    },\n\n    get state() {\n      return t;\n    },\n\n    set state(e) {\n      t = e;\n    },\n\n    get options() {\n      return e;\n    },\n\n    set options(t) {\n      e = t;\n    }\n\n  };\n}(),\n    n = e.createContext(void 0),\n    o = function (o) {\n  var r = o.children,\n      s = e.useState(t.state),\n      a = s[0],\n      i = s[1];\n  return e.useEffect(function () {\n    \"beforeUnload\" === t.options.persist && (window.onbeforeunload = function () {\n      return t.saveStore();\n    }, t.options.storageType.removeItem(t.options.name));\n  }, []), e.createElement(n.Provider, {\n    value: {\n      state: a,\n      setState: i\n    }\n  }, r);\n};\n\nfunction r() {\n  return r = Object.assign || function (e) {\n    for (var t = 1; t < arguments.length; t++) {\n      var n = arguments[t];\n\n      for (var o in n) Object.prototype.hasOwnProperty.call(n, o) && (e[o] = n[o]);\n    }\n\n    return e;\n  }, r.apply(this, arguments);\n}\n\nfunction s(e, n) {\n  n && (t.options = r({}, t.options, n)), \"production\" !== process.env.NODE_ENV && \"undefined\" != typeof window && (window.__LSM_NAME__ = t.options.name, window.__LSM_RESET__ = function () {\n    return t.options.storageType.removeItem(t.options.name);\n  }), t.updateStore(e);\n}\n\nfunction a(o) {\n  var r = e.useContext(n),\n      s = r.state,\n      a = r.setState,\n      i = e.useRef(Object.entries(o || {}).reduce(function (e, n) {\n    var o;\n    return Object.assign({}, e, ((o = {})[n[0]] = function (e, n) {\n      return function (o) {\n        \"production\" !== process.env.NODE_ENV && (window.__LSM_NAME__ = n.name), t.state = n(t.state, o), t.options.middleWares && (t.state = t.options.middleWares.reduce(function (e, t) {\n          return t(e, n.name, o) || e;\n        }, t.state)), e(t.state), \"beforeUnload\" !== t.options.persist && t.saveStore();\n      };\n    }(a, n[1]), o));\n  }, {}));\n  return {\n    actions: i.current,\n    state: s\n  };\n}\n\nexport { o as StateMachineProvider, s as createStore, a as useStateMachine };","map":{"version":3,"mappings":";;AA+CA,QA5CA;EACE,IAAIA,IAAU;IACZC,MCL8B,SDIlB;IAEZC,aAAa,EAFD;IAGZC,aAAa,EAHD;IAIZC,SAAS;EAJG,CAAd;EAAA,IAMIC,IAAqB,EANzB;;EAQA;IACEL,EAAQG,WAARH,GAC4B,sBAAnBM,cAAmB,GACtBC,OAAOD,cADe,GAErB,EAHPN;EAIA,CALF,CAKE,WAEF;;EAAA,OAAO;IACLQ,uBAAYC,CAAZD,EAAYC;MACV;QACEJ,IACEK,KAAKC,KAALD,CAAWV,EAAQG,WAARH,CAAoBY,OAApBZ,CAA4BA,EAAQC,IAApCD,KAA6C,EAAxDU,KACAD,CAFFJ;MAGA,CAJF,CAIE;QACAA,IAAQI,CAARJ;MAAQI;IAAAA,CAPP;IAULI;MACEb,EAAQG,WAARH,CAAoBc,OAApBd,CAA4BA,EAAQC,IAApCD,EAA0CU,KAAKK,SAALL,CAAeL,CAAfK,CAA1CV;IAAyDK,CAXtD;;IAaDA;MACF,OAAOA,CAAP;IAAOA,CAdJ;;IAgBDA,UAAMW,CAANX,EAAMW;MACRX,IAAQW,CAARX;IAAQW,CAjBL;;IAmBDhB;MACF,OAAOA,CAAP;IAAOA,CApBJ;;IAsBDA,YAAQgB,CAARhB,EAAQgB;MACVhB,IAAUgB,CAAVhB;IAAUgB;;EAvBP,CAAP;AA4BaC,CA5Cf,EA4CA;AAAA,IEtCMC,IAAsBC,EAAMC,aAAND,CAAMC,KAChCC,CAD0BF,CFsC5B;AAAA,IElCaG,IAAgD;EAAA,IAAGC,cAAH;EAAA,IAAGA,IACpCJ,EAAMK,QAANL,CAAeM,EAAapB,KAA5Bc,CADiC;EAAA,IACpDd,QADoD;EAAA,IAC7CqB,QAD6C;EAU3D,OAPAP,EAAMQ,SAANR,CAAgB;IDdmB,mBCe7BM,EAAazB,OAAbyB,CAAqBrB,ODfQ,KCgB/BG,OAAOqB,cAAPrB,GAAwB;MAAA,OAAMkB,EAAaZ,SAAbY,EAAN;IAAmBZ,CAA3CN,EACAkB,EAAazB,OAAbyB,CAAqBtB,WAArBsB,CAAiCI,UAAjCJ,CAA4CA,EAAazB,OAAbyB,CAAqBxB,IAAjEwB,CDjB+B;ECiBkCxB,CAHrEkB,EAKG,EALHA,GAQEA,gBAACD,EAAoBY,QAArBX,EAAqBW;IAASd,OAAO;MAAEX,QAAF;MAASqB;IAAT;EAAhBI,CAArBX,EACGI,CADHJ,CADF;AAEKI,CFsBP;;AEtBOA;EAAAA;IAAAA;MAAAA;;MAAAA;IAAAA;;IAAAA;EAAAA;AAAAA;;AAAAA,SCbSQ,CDaTR,CCZLS,CDYKT,ECXLvB,CDWKuB,ECXLvB;EAEIA,MACFyB,EAAazB,OAAbyB,GAAazB,MACRyB,EAAazB,OADLA,EAERA,CAFQA,CADXA,GAOyB,iBAAzBiC,QAAQC,GAARD,CAAYE,QAAa,IACL,sBAAX5B,MADgB,KAEzBA,OAAO6B,YAAP7B,GAAsBkB,EAAazB,OAAbyB,CAAqBxB,IAA3CM,EACAA,OAAO8B,aAAP9B,GAAuB;IAAA,OACrBkB,EAAazB,OAAbyB,CAAqBtB,WAArBsB,CAAiCI,UAAjCJ,CAA4CA,EAAazB,OAAbyB,CAAqBxB,IAAjEwB,CADqB;EAC4CxB,CAJ1C,CAPzBD,EAeJyB,EAAajB,WAAbiB,CAAyBO,CAAzBP,CAfIzB;AAeqBgC;;AAAAA,SA4BXM,CA5BWN,CAgCzBO,CAhCyBP,EAgCzBO;EAKA,QDrCApB,EAAMqB,UAANrB,CAA2CD,CAA3CC,CCqCA;EAAA,IAAQd,WAAR;EAAA,IAAeqB,cAAf;EAAA,IACMe,IAAatB,EAAMuB,MAANvB,CACjBwB,OAAOC,OAAPD,CAAeJ,KAAW,EAA1BI,EAA8BE,MAA9BF,CACE,UAACG,CAAD,EAACA,CAAD,EAACA;IAAAA;IAAAA,OACCH,OAAOI,MAAPJ,CAAc,EAAdA,EAAkBG,CAAlBH,GAAkBG,iBArCxB,UACEpB,CADF,EAEEsB,CAFF,EAEEA;MAAAA,iBAEDC,CAFCD,EAEDC;QAC8B,iBAAzBhB,QAAQC,GAARD,CAAYE,QAAa,KAC3B5B,OAAM6B,YAAN7B,GAA4ByC,EAAS/C,IADV,GAI7BwB,EAAapB,KAAboB,GAAqBuB,EAASvB,EAAapB,KAAtB2C,EAA6BC,CAA7BD,CAJQ,EAMzBvB,EAAazB,OAAbyB,CAAqBvB,WAArBuB,KACFA,EAAapB,KAAboB,GAAqBA,EAAazB,OAAbyB,CAAqBvB,WAArBuB,CAAiCoB,MAAjCpB,CACnB,UAACyB,CAAD,EAAeC,CAAf,EAAeA;UAAAA,OACbA,EAAgBD,CAAhBC,EAA8BH,EAAS/C,IAAvCkD,EAA6CF,CAA7CE,KAAyDD,CAD5CC;QAC4CD,CAFxCzB,EAGnBA,EAAapB,KAHMoB,CADnBA,CANyB,EAc7BC,EAASD,EAAapB,KAAtBqB,CAd6B,EFtCI,mBEqDjCD,EAAazB,OAAbyB,CAAqBrB,OFrDY,IEsD/BqB,EAAaZ,SAAbY,EAhB2B;MAgBdZ,CAnBfmC;IAoCaI,CAtCf,CAsC8B1B,CAtC9B,EAsC8BA,IAtC9B,CAqCwBoB,EACMpB,CADxBiB,EADDG;EAEyBpB,CAH5BiB,EAKE,EALFA,CADiBxB,CADnB;EAWA,OAAO;IACLoB,SAASE,EAAWY,OADf;IAELhD;EAFK,CAAP;AAEEA;;AAAAA","names":["options","name","middleWares","storageType","persist","state","sessionStorage","window","updateStore","defaultValues","JSON","parse","getItem","saveStore","setItem","stringify","value","StoreFactory","StateMachineContext","React","createContext","undefined","StateMachineProvider","children","useState","storeFactory","setState","useEffect","onbeforeunload","removeItem","Provider","createStore","defaultState","process","env","NODE_ENV","__LSM_NAME__","__LSM_RESET__","useStateMachine","actions","useContext","actionsRef","useRef","Object","entries","reduce","previous","assign","callback","payload","currentValue","currentFunction","actionTemplate","current"],"sources":["/Users/x19012xx/Documents/GitHub/orionn0111.github.io/test-react/node_modules/little-state-machine/src/logic/storeFactory.ts","/Users/x19012xx/Documents/GitHub/orionn0111.github.io/test-react/node_modules/little-state-machine/src/constants.ts","/Users/x19012xx/Documents/GitHub/orionn0111.github.io/test-react/node_modules/little-state-machine/src/StateMachineContext.tsx","/Users/x19012xx/Documents/GitHub/orionn0111.github.io/test-react/node_modules/little-state-machine/src/stateMachine.tsx"],"sourcesContent":["import { STORE_DEFAULT_NAME } from '../constants';\nimport { MiddleWare, GlobalState } from '../types';\n\nfunction StoreFactory() {\n  let options = {\n    name: STORE_DEFAULT_NAME,\n    middleWares: [] as MiddleWare[],\n    storageType: {} as Storage,\n    persist: '',\n  };\n  let state: GlobalState = {};\n\n  try {\n    options.storageType =\n      typeof sessionStorage !== 'undefined'\n        ? window.sessionStorage\n        : ({} as Storage);\n  } catch {}\n\n  return {\n    updateStore(defaultValues: GlobalState) {\n      try {\n        state =\n          JSON.parse(options.storageType.getItem(options.name) || '') ||\n          defaultValues;\n      } catch {\n        state = defaultValues;\n      }\n    },\n    saveStore() {\n      options.storageType.setItem(options.name, JSON.stringify(state));\n    },\n    get state() {\n      return state;\n    },\n    set state(value) {\n      state = value;\n    },\n    get options() {\n      return options;\n    },\n    set options(value) {\n      options = value;\n    },\n  };\n}\n\nexport default StoreFactory();\n","export const STORE_DEFAULT_NAME = '__LSM__';\nexport const STORE_ACTION_NAME = '__LSM_NAME__';\nexport const PERSIST_BEFORE_UNLOAD = 'beforeUnload';\n","import * as React from 'react';\nimport storeFactory from './logic/storeFactory';\nimport { StateMachineContextValue } from './types';\nimport { PERSIST_BEFORE_UNLOAD } from './constants';\n\ntype PropsChildren = {\n  children?: React.ReactNode;\n};\n\nconst StateMachineContext = React.createContext<StateMachineContextValue>(\n  undefined as any,\n);\n\nexport const StateMachineProvider: React.FC<PropsChildren> = ({ children }) => {\n  const [state, setState] = React.useState(storeFactory.state);\n\n  React.useEffect(() => {\n    if (storeFactory.options.persist === PERSIST_BEFORE_UNLOAD) {\n      window.onbeforeunload = () => storeFactory.saveStore();\n      storeFactory.options.storageType.removeItem(storeFactory.options.name);\n    }\n  }, []);\n\n  return (\n    <StateMachineContext.Provider value={{ state, setState }}>\n      {children}\n    </StateMachineContext.Provider>\n  );\n};\n\nexport const useStateMachineContext = () =>\n  React.useContext<StateMachineContextValue>(StateMachineContext);\n","import * as React from 'react';\nimport { useStateMachineContext } from './StateMachineContext';\nimport storeFactory from './logic/storeFactory';\nimport {\n  StateMachineOptions,\n  GlobalState,\n  AnyCallback,\n  AnyActions,\n  ActionsOutput,\n} from './types';\nimport { PERSIST_BEFORE_UNLOAD, STORE_ACTION_NAME } from './constants';\n\nexport function createStore(\n  defaultState: GlobalState,\n  options?: StateMachineOptions,\n) {\n  if (options) {\n    storeFactory.options = {\n      ...storeFactory.options,\n      ...options,\n    };\n  }\n\n  if (process.env.NODE_ENV !== 'production') {\n    if (typeof window !== 'undefined') {\n      window.__LSM_NAME__ = storeFactory.options.name;\n      window.__LSM_RESET__ = () =>\n        storeFactory.options.storageType.removeItem(storeFactory.options.name);\n    }\n  }\n\n  storeFactory.updateStore(defaultState);\n}\n\nconst actionTemplate =\n  <TCallback extends AnyCallback>(\n    setState: React.Dispatch<React.SetStateAction<GlobalState>>,\n    callback: TCallback,\n  ) =>\n  (payload: Parameters<TCallback>[1]) => {\n    if (process.env.NODE_ENV !== 'production') {\n      window[STORE_ACTION_NAME] = callback.name;\n    }\n\n    storeFactory.state = callback(storeFactory.state, payload);\n\n    if (storeFactory.options.middleWares) {\n      storeFactory.state = storeFactory.options.middleWares.reduce(\n        (currentValue, currentFunction) =>\n          currentFunction(currentValue, callback.name, payload) || currentValue,\n        storeFactory.state,\n      );\n    }\n\n    setState(storeFactory.state);\n    storeFactory.options.persist !== PERSIST_BEFORE_UNLOAD &&\n      storeFactory.saveStore();\n  };\n\nexport function useStateMachine<\n  TCallback extends AnyCallback,\n  TActions extends AnyActions<TCallback>,\n>(\n  actions?: TActions,\n): {\n  actions: ActionsOutput<TCallback, TActions>;\n  state: GlobalState;\n} {\n  const { state, setState } = useStateMachineContext();\n  const actionsRef = React.useRef(\n    Object.entries(actions || {}).reduce(\n      (previous, [key, callback]) =>\n        Object.assign({}, previous, {\n          [key]: actionTemplate(setState, callback),\n        }),\n      {} as ActionsOutput<TCallback, TActions>,\n    ),\n  );\n\n  return {\n    actions: actionsRef.current,\n    state,\n  };\n}\n"]},"metadata":{},"sourceType":"module"}